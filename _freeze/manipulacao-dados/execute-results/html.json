{
  "hash": "d4f1d1e0afdc92bbc84ca3ad7c7aab32",
  "result": {
    "engine": "knitr",
    "markdown": "# Manipulação de Dados com Tidyverse\n\n## O que é o Tidyverse?\n\nO **tidyverse** é uma coleção de pacotes R projetados para ciência de dados. Todos os pacotes compartilham uma filosofia de design, gramática e estruturas de dados subjacentes, tornando o trabalho com dados mais intuitivo e eficiente.\n\n### Pacotes Principais do Tidyverse\n\n-   **dplyr**: Manipulação de dados (filtrar, selecionar, agrupar, sumarizar)\n-   **ggplot2**: Criação de gráficos elegantes\n-   **tidyr**: Organização e limpeza de dados\n-   **readr**: Leitura rápida de dados tabulares (CSV, TSV)\n-   **purrr**: Programação funcional\n-   **tibble**: Versão moderna de data frames\n-   **stringr**: Manipulação de strings\n-   **forcats**: Manipulação de fatores\n\n### Por que usar o Tidyverse?\n\n-   **Código mais legível**: Sintaxe intuitiva e consistente\n-   **Pipe operator**: Encadeamento de operações de forma natural \\|\\> ou %\\>%\n-   **Eficiência**: Otimizado para grandes volumes de dados\n-   **Comunidade**: Ampla documentação e suporte\n-   **Integração**: Pacotes desenvolvidos com funcionalidade integrada\n\n## Instalação e Carregamento de Pacotes\n\n### Instalando Pacotes\n\nPara instalar um pacote no R, usamos a função `install.packages()`:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Instalando um pacote individual\ninstall.packages(\"tidyverse\")\n\n# Instalando múltiplos pacotes\ninstall.packages(c(\"tidyverse\", \"readxl\", \"janitor\"))\n```\n:::\n\n\n**Importante**: Você só precisa instalar um pacote uma vez. Após a instalação, o pacote fica disponível permanentemente.\n\n### Carregando Pacotes\n\nApós instalados, os pacotes precisam ser carregados em cada sessão usando `library()`:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Carregando os pacotes necessários\nlibrary(tidyverse)  # Manipulação e visualização de dados\nlibrary(readxl)     # Leitura de arquivos Excel\n```\n:::\n\n\n## Importando Dados\n\n### Leitura de Arquivos Excel\n\nA função `read_excel()` do pacote **readxl** permite importar dados de arquivos Excel:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Importando dados de internações hospitalares\ndados <- read_excel(\"data/dados_internacoes_maringa_2024.xlsx\")\n```\n:::\n\n\n::: callout-note\n## Sobre o diretório de trabalho\n\n**Importante**: Sempre verifique se você está no diretório correto. Coloque os scripts e dados para análise em um mesmo diretório.\n\n![](images/working_directory.png)\n\nO R só reconhece arquivos que está pasta do diretório de trabalho.\n\nPara selecionar essa pasta, clique nos ... na imagem, selecione a pasta com os scripts e dados e clique em **Set as working directory**.\n:::\n\n::: callout-note\n## Organização das pastas no diretório de trabalho\n\nOrganize os dados e os scripts em pastas, para todos os arquivos ficarem organizados.\\\n\\\nSugestão de organização:\n\n-   Pasta data, com os dados brutos e filtrados/analisados\n\n-   Pasta scripts, com os scripts utilizados na análise\n\n-   Pasta figuras, com as figuras geradas\n\n-   Pasta tabelas, com as tabelas geradas\n\n-   Pasta manuscrito, se utilizar o R para escrita científica\n:::\n\n::: callout-note\n## Sobre os dados utilizados nesse livro.\n\nOs dados utilizados neste livro são de internações hospitalares de Maringá-PR referentes ao ano de 2024, disponibilizados pelo Sistema de Informações Hospitalares (SIH) do SUS. Os dados são anonimizados e de domínio público.\n\nO arquivo `dados_internacoes_maringa_2024.xlsx` deve estar na pasta `data/` do seu projeto.\n:::\n\n### Explorando os Dados Importados\n\nApós importar, é importante explorar a estrutura dos dados:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Resumo estatístico das variáveis\nsummary(dados)\n\n# Visão geral da estrutura (tidyverse)\nglimpse(dados)\n\n# Estrutura detalhada (R base)\nstr(dados)\n```\n:::\n\n\nEssas funções fornecem informações sobre:\n\n-   Número de linhas e colunas\n-   Tipos de dados de cada variável\n-   Primeiros valores de cada coluna\n-   Valores ausentes (NAs)\n\n## Principais Funções do Tidyverse\n\nO tidyverse oferece um conjunto de funções poderosas para manipulação de dados:\n\n| Função        | Descrição                          |\n|---------------|------------------------------------|\n| `select()`    | Seleciona colunas específicas      |\n| `filter()`    | Filtra linhas baseado em condições |\n| `mutate()`    | Cria ou modifica colunas           |\n| `rename()`    | Renomeia colunas                   |\n| `group_by()`  | Agrupa dados por variáveis         |\n| `summarise()` | Calcula estatísticas resumidas     |\n\nVamos explorar cada uma dessas funções em detalhes.\n\n### select(): Selecionando Colunas\n\nA função `select()` permite escolher quais colunas manter no seu data frame:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Selecionando apenas as colunas SEXO e IDADE\ndados_selecionados <- select(dados, SEXO, IDADE)\n\nglimpse(dados_selecionados)\n```\n:::\n\n\n#### Excluindo Colunas\n\nVocê pode também remover colunas específicas usando o sinal de menos `-`:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Removendo a coluna CEP\ndados2 <- select(dados, -CEP)\n```\n:::\n\n\n#### Seleção Avançada\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Selecionar colunas que começam com determinado texto\nselect(dados, starts_with(\"VAL\"))\n\n# Selecionar colunas que terminam com determinado texto\nselect(dados, ends_with(\"_TOT\"))\n\n# Selecionar colunas que contêm determinado texto\nselect(dados, contains(\"IDADE\"))\n\n# Selecionar colunas numéricas\nselect(dados, where(is.numeric))\n```\n:::\n\n\n### filter(): Filtrando Linhas\n\nA função `filter()` permite selecionar linhas que atendem a determinadas condições:\n\n#### Filtro Simples\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Filtrando apenas pacientes do sexo masculino\ndados_masculino <- filter(dados, SEXO == \"Masculino\")\n\n# Filtrando pacientes que NÃO são do sexo masculino\ndados_feminino <- filter(dados, SEXO != \"Masculino\")\n```\n:::\n\n\n#### Múltiplas Condições\n\nUse o operador `&` (E) para combinar condições:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Homens que foram a óbito\ndados_masculino_morte <- filter(dados, SEXO == \"Masculino\" & MORTE == \"Sim\")\n\n# Homens idosos (>=60 anos) que foram a óbito\ndados_masculino_morte_idosos <- filter(\n  dados,\n  SEXO == \"Masculino\" & MORTE == \"Sim\" & IDADE >= 60\n)\n```\n:::\n\n\n#### Outros Operadores Lógicos\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Operador OU (|): pacientes com idade menor que 18 OU maior que 60\nfilter(dados, IDADE < 18 | IDADE > 60)\n\n# Operador %in%: selecionar múltiplos valores\nfilter(dados, RACA_COR %in% c(\"Branca\", \"Parda\"))\n\n# Valores ausentes\nfilter(dados, is.na(IDADE))  # Linhas com idade ausente\nfilter(dados, !is.na(IDADE))  # Linhas SEM idade ausente\n```\n:::\n\n\n### mutate(): Criando e Modificando Colunas\n\nA função `mutate()` é usada para criar novas colunas ou modificar existentes:\n\n#### Criando Nova Coluna\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Criando nova coluna com valor total multiplicado por 1000\ndados_valor_1000 <- mutate(dados, VAL_TOT_1000 = VAL_TOT * 1000)\n```\n:::\n\n\n#### Modificando Tipo de Dados\n\nA função `across()` permite aplicar uma transformação a múltiplas colunas:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Convertendo IDADE e DIAS_PERM para numérico\ndados <- mutate(dados, across(c(IDADE, DIAS_PERM), as.numeric))\n\n# Convertendo múltiplas colunas para fator\ndados <- mutate(dados, across(c(SEXO, RACA_COR, MORTE), as.factor))\n```\n:::\n\n\n#### Recodificando Variáveis com case_when()\n\nA função `case_when()` é útil para criar categorias baseadas em múltiplas condições:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Recodificando códigos numéricos de raça/cor para texto descritivo\ndados <- mutate(\n  dados,\n  RACA_COR = case_when(\n    RACA_COR == '01' ~ \"Branca\",\n    RACA_COR == \"02\" ~ \"Preta\",\n    RACA_COR == \"03\" ~ \"Parda\",\n    RACA_COR == \"04\" ~ \"Amarela\",\n    RACA_COR == \"05\" ~ \"Indígena\"\n  )\n)\n```\n:::\n\n\nOutros exemplos de `case_when()`:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Classificando faixas etárias\ndados <- mutate(\n  dados,\n  faixa_etaria = case_when(\n    IDADE < 18 ~ \"Criança/Adolescente\",\n    IDADE >= 18 & IDADE < 60 ~ \"Adulto\",\n    IDADE >= 60 ~ \"Idoso\"\n  )\n)\n\n# Classificando permanência hospitalar\ndados <- mutate(\n  dados,\n  tempo_internacao = case_when(\n    DIAS_PERM <= 3 ~ \"Curta\",\n    DIAS_PERM > 3 & DIAS_PERM <= 7 ~ \"Média\",\n    DIAS_PERM > 7 ~ \"Longa\"\n  )\n)\n```\n:::\n\n\n### rename(): Renomeando Colunas\n\nA função `rename()` permite alterar nomes de colunas:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Renomeando a coluna ESPEC para ESPECIALIDADE\ndados <- rename(dados, ESPECIALIDADE = ESPEC)\n\n# Sintaxe: novo_nome = nome_antigo\n```\n:::\n\n\nRenomeando múltiplas colunas:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndados <- rename(\n  dados,\n  especialidade = ESPEC,\n  diagnostico = DIAG_PRINC,\n  idade_anos = IDADE\n)\n```\n:::\n\n\n### group_by() e summarise(): Sumarizando Dados\n\nEstas funções trabalham em conjunto para calcular estatísticas agrupadas.\n\n#### Agrupamento e Sumarização Básica\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Calculando idade média por sexo e raça/cor\ndados_agrupados <- dados |>\n  group_by(SEXO, RACA_COR) |>\n  summarise(mean_idade = mean(IDADE), .groups = \"drop\")\n\ndados_agrupados\n```\n:::\n\n\n#### Múltiplas Estatísticas\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Calculando várias estatísticas ao mesmo tempo\nestatisticas <- dados |>\n  group_by(SEXO) |>\n  summarise(\n    n = n(),                          # Contagem\n    idade_media = mean(IDADE, na.rm = TRUE),\n    idade_dp = sd(IDADE, na.rm = TRUE),\n    idade_mediana = median(IDADE, na.rm = TRUE),\n    idade_min = min(IDADE, na.rm = TRUE),\n    idade_max = max(IDADE, na.rm = TRUE),\n    .groups = \"drop\"\n  )\n```\n:::\n\n\n## O Operador Pipe \\|\\>\n\nO **pipe operator** `|>` é uma das ferramentas mais úteis do tidyverse. Ele permite encadear múltiplas operações de forma legível.\n\n### Como Ler o Pipe\n\nO símbolo `|>` pode ser lido como **\"E ENTÃO\"** ou **\"PASSE PARA\"**.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Sem pipe (difícil de ler)\nresultado <- summarise(\n  group_by(\n    filter(dados, SEXO == \"Masculino\"),\n    RACA_COR\n  ),\n  media_idade = mean(IDADE)\n)\n\n# Com pipe (fácil de ler)\nresultado <- dados |>\n  filter(SEXO == \"Masculino\") |>\n  group_by(RACA_COR) |>\n  summarise(media_idade = mean(IDADE))\n```\n:::\n\n\n**Leitura**: \"Pegue os dados E ENTÃO filtre para sexo masculino E ENTÃO agrupe por raça/cor E ENTÃO calcule a média de idade\"\n\n### Atalho de Teclado\n\n-   **Windows/Linux**: `Ctrl + Shift + M`\n-   **Mac**: `Cmd + Shift + M`\n\n::: callout-tip\n## Pipe Nativo vs. Pipe do magrittr\n\nO R possui dois operadores pipe:\n\n-   `|>` - Pipe nativo do R (versão 4.1+) - usado neste livro\n-   `%>%` - Pipe do pacote magrittr\n\nAmbos funcionam de forma similar. Usamos `|>` por ser a implementação oficial e não requerer pacotes adicionais.\n:::\n\n## Encadeamento de Operações\n\nO verdadeiro poder do tidyverse aparece quando combinamos múltiplas operações:\n\n### Exemplo Completo de Pipeline\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Pipeline complexo de limpeza e análise de dados\ndados_limpos <- dados |>\n  # 1. Selecionar colunas relevantes\n  select(SEXO, RACA_COR, IDADE, MORTE, COD_IDADE) |>\n  # 2. Filtrar apenas idades em anos\n  filter(COD_IDADE == \"Anos\") |>\n  # 3. Remover coluna COD_IDADE (não mais necessária)\n  select(-COD_IDADE) |>\n  # 4. Converter IDADE para numérico\n  mutate(across(IDADE, as.numeric)) |>\n  # 5. Converter variáveis categóricas para fator\n  mutate(across(c(SEXO, RACA_COR, MORTE), as.factor)) |>\n  # 6. Recodificar raça/cor\n  mutate(RACA_COR = case_when(\n    RACA_COR == '01' ~ \"Branca\",\n    RACA_COR == \"02\" ~ \"Preta\",\n    RACA_COR == \"03\" ~ \"Parda\",\n    RACA_COR == \"04\" ~ \"Amarela\",\n    RACA_COR == \"05\" ~ \"Indígena\"\n  )) |>\n  # 7. Renomear colunas para minúsculas\n  rename(\n    sexo = SEXO,\n    raca_cor = RACA_COR,\n    idade = IDADE,\n    morte = MORTE\n  ) |>\n  # 8. Agrupar por raça/cor e sexo\n  group_by(raca_cor, sexo) |>\n  # 9. Calcular idade média por grupo\n  summarise(mean_idade = mean(idade), .groups = \"drop\")\n\ndados_limpos\n```\n:::\n\n\n### Vantagens do Encadeamento\n\n1.  **Legibilidade**: Código lido de cima para baixo, como uma receita\n2.  **Manutenção**: Fácil adicionar, remover ou modificar etapas\n3.  **Eficiência**: Evita criar múltiplos objetos intermediários\n4.  **Debug**: Fácil testar executando até determinado ponto\n\n### Dica para Debug\n\nVocê pode executar o pipeline até qualquer ponto selecionando o código desejado:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Selecione e execute até a linha que deseja inspecionar\ndados |>\n  select(SEXO, RACA_COR, IDADE, MORTE, COD_IDADE) |>\n  filter(COD_IDADE == \"Anos\")  # Execute até aqui para ver o resultado\n# |> select(-COD_IDADE)          # Não será executado\n```\n:::\n\n\n## Outras Funções Úteis do dplyr\n\n### arrange(): Ordenando Dados\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Ordenar por idade (crescente)\ndados |> arrange(IDADE)\n\n# Ordenar por idade (decrescente)\ndados |> arrange(desc(IDADE))\n\n# Ordenar por múltiplas colunas\ndados |> arrange(SEXO, desc(IDADE))\n```\n:::\n\n\n### count(): Contagem Rápida\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Contar frequências de uma variável\ndados |> count(SEXO)\n\n# Contar combinações\ndados |> count(SEXO, MORTE)\n\n# Ordenar por frequência\ndados |> count(RACA_COR, sort = TRUE)\n```\n:::\n\n\n### distinct(): Valores Únicos\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Valores únicos de uma coluna\ndados |> distinct(SEXO)\n\n# Remover linhas duplicadas completas\ndados |> distinct()\n```\n:::\n\n\n### slice(): Seleção por Posição\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Primeiras 10 linhas\ndados |> slice(1:10)\n\n# Linhas específicas\ndados |> slice(c(1, 5, 10))\n\n# Top 5 idades mais altas\ndados |> slice_max(IDADE, n = 5)\n\n# Bottom 5 idades mais baixas\ndados |> slice_min(IDADE, n = 5)\n```\n:::\n\n\n## Pacote janitor: Limpeza de Nomes\n\nO pacote **janitor** oferece funções úteis para limpeza de dados, especialmente nomes de colunas:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(janitor)\n\n# Limpar nomes de colunas (remove acentos, espaços, caracteres especiais)\ndados <- clean_names(dados)\n\n# Antes: \"Nome da Variável\"\n# Depois: \"nome_da_variavel\"\n```\n:::\n\n\n## Resumo do Capítulo\n\nNeste capítulo, você aprendeu:\n\n-   **O que é o tidyverse** e seus principais pacotes\n-   Como **instalar e carregar pacotes** no R\n-   **Importar dados** de arquivos Excel com `read_excel()`\n-   **Explorar dados** com `summary()`, `glimpse()` e `str()`\n-   **Principais funções do dplyr**:\n    -   `select()` - Selecionar colunas\n    -   `filter()` - Filtrar linhas\n    -   `mutate()` - Criar/modificar colunas\n    -   `rename()` - Renomear colunas\n    -   `group_by()` e `summarise()` - Agrupar e sumarizar\n-   **Usar o pipe operator** `|>` para encadear operações\n-   **Criar pipelines complexos** de limpeza e análise de dados\n-   **Funções adicionais** como `arrange()`, `count()`, `distinct()`, `slice()`\n\nNo próximo capítulo, você aprenderá a realizar **análises exploratórias de dados**, incluindo estatística descritiva, testes estatísticos e visualização com ggplot2.\n\n## Exercícios Práticos\n\n1.  Carregue o arquivo `dados_internacoes_maringa_2024.xlsx` e explore sua estrutura\n\n2.  Crie um pipeline que:\n\n    -   Selecione as colunas SEXO, IDADE, DIAS_PERM, VAL_TOT, MORTE\n    -   Filtre apenas pacientes adultos (IDADE \\>= 18)\n    -   Crie uma coluna categorizando o tempo de permanência (curta: ≤3 dias, média: 4-7 dias, longa: \\>7 dias)\n    -   Calcule a idade média e o valor total médio por sexo e categoria de permanência\n\n3.  Identifique as 10 especialidades médicas com maior número de internações",
    "supporting": [
      "manipulacao-dados_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\n<script src=\"site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}